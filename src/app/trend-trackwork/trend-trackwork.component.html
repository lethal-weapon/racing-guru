<div *ngIf="isLoading">
  <app-spinner></app-spinner>
</div>

<div *ngIf="!isLoading" class="mx-8">
  <div class="my-4 flex flex-row justify-evenly">
    <div *ngFor="let section of [BY_STATS]"
         class="px-4 pt-1.5 pb-2 text-xl rounded-full border {{getBadgeStyle(section)}}"
         (click)="activeBadge = section"
    >
      {{ section }}
    </div>
    <div *ngFor="let ts of trackworks"
         class="px-4 pt-1.5 pb-2 text-xl rounded-full border {{getBadgeStyle(ts.meeting)}}"
         (click)="activeBadge = ts.meeting"
    >
      {{ formatMeeting(ts.meeting) }}
      {{ ts.venue }}
    </div>
  </div>

  <div *ngIf="![BY_STATS].includes(activeBadge)"
       class="grid grid-cols-4 gap-x-4 gap-y-2"
  >
    <div *counter="let race of maxRace"
         class="pt-2 pb-3 px-4 shadow-md transition shadow-gray-600 hover:shadow-gray-400"
    >
      <div class="mb-2 text-yellow-400 text-lg">
        Race #{{ race }}
      </div>
      <div *ngFor="let starter of getRaceStarters(race); let index = index"
           class="grid grid-cols-12 {{toPlacingColor(starter?.placing)}}"
           [class.opacity-50]="starter.scratched"
           [class.line-through]="starter.scratched"
      >
        <div class="col-span-1">
          <span *ngIf="starter.trainerFocus">
            <i class="fa fa-chevron-right"></i>
          </span>
        </div>
        <div class="col-span-1">
          {{ starter.order }}
        </div>
        <div class="col-span-4">
          {{ starter.horseNameCH }}
        </div>
        <div class="col-span-2">
          {{ starter.trainer }}
        </div>
        <div class="col-span-2 "
             [class.invisible]="getStarterWinOdds(starter) < 1"
        >
          {{ getStarterWinOdds(starter) | number: '1.0-1' }}
        </div>
        <div class="col-span-2 {{getGradeBorderStyle(race, starter, index)}}">
          {{ starter.intensity.toFixed(1) }}
          {{ starter.grade }}
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeBadge === BY_STATS"
       class="grid grid-cols-4 gap-x-4 gap-y-2 text-lg"
  >
    <div *ngFor="let grade of RATING_GRADES"
         class="pt-2 pb-3 px-4 shadow-md transition shadow-gray-600 hover:shadow-gray-400"
    >
      <div class="mb-2 text-yellow-400">
        Grade {{ grade }}
        ({{ getGradeStarters(grade).length }} , {{ getGradeStarters(grade).length / starters.length | percent }})
      </div>
      <table class="mx-auto border-collapse">
        <thead>
          <th class="px-2 invisible">X</th>
          <th class="px-2 invisible">X</th>
          <th class="px-2 invisible">X</th>
          <th class="px-2 invisible">X</th>
          <th *ngFor="let oi of ODDS_INTENSITIES"
              class="px-2"
          >
            {{ oi.category.charAt(0).toUpperCase() }}
          </th>
        </thead>
        <tbody>
          <tr *ngFor="let pm of PLACING_MAPS; let index = index"
              class="{{pm.color}}"
          >
            <td class="px-2 font-mono">
              {{ pm.placing }}
            </td>
            <td class="px-2">
              {{ getGradePlacingStarters(grade, index + 1).length }}
            </td>
            <td class="px-2">
              {{ (getGradePlacingStarters(grade, index + 1).length / getGradeStarters(grade).length) | percent }}
            </td>
            <td class="px-2">
            </td>
            <td *ngFor="let oi of ODDS_INTENSITIES"
                class="px-2"
            >
              <span *ngIf=" getGradePlacingStartersInOddsRange(grade, index + 1, oi).length < 1">
                -
              </span>
              <span *ngIf=" getGradePlacingStartersInOddsRange(grade, index + 1, oi).length >= 1">
                {{ getGradePlacingStartersInOddsRange(grade, index + 1, oi).length }}
              </span>
            </td>
          </tr>
          <tr>
            <td class="px-2 font-mono">
              T
            </td>
            <td class="px-2">
              {{ getGradeTop4Starters(grade).length }}
            </td>
            <td class="px-2">
              {{ (getGradeTop4Starters(grade).length / getGradeStarters(grade).length) | percent }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngFor="let group of trainerGroups; let index = index"
         class="pt-2 pb-3 px-2 shadow-md transition shadow-gray-600 hover:shadow-gray-400"
    >
      <div class="mb-2 text-yellow-400">
        Group {{ index + 1 }}
        ({{ getTrainerGroupStarters(group).length }}
        , {{ getTrainerGroupStarters(group).length / starters.length | percent }})
      </div>
      <table class="mx-auto border-collapse">
        <thead>
          <th class="px-2 invisible">X</th>
          <th class="px-2 invisible">X</th>
          <th class="px-2">
            T4
          </th>
          <th *ngFor="let grade of RATING_GRADES"
              class="px-2"
          >
            {{ grade }}
          </th>
        </thead>
        <tbody>
          <tr *ngFor="let trainer of group">
            <td class="px-2 font-mono">
              {{ trainer.code }}
            </td>
            <td class="px-2">
              {{ getTrainerStarters(trainer).length }}
            </td>
            <td class="px-2">
              {{ (getTrainerTop4Starters(trainer).length / getTrainerStarters(trainer).length) | percent }}
            </td>
            <td *ngFor="let grade of RATING_GRADES"
                class="px-2"
            >
              <span *ngIf="getTrainerGradeTop4Starters(trainer, grade).length < 1">
                -
              </span>
              <span *ngIf="getTrainerGradeTop4Starters(trainer, grade).length >= 1">
                {{ getTrainerGradeTop4Starters(trainer, grade).length }}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
