<div *ngIf="isLoading">
  <app-spinner></app-spinner>
</div>

<div *ngIf="!isLoading">
  <div class="m-4 flex flex-row justify-evenly">
    <div *ngFor="let section of [BY_FOCUS]"
         class="px-4 pt-1.5 pb-2 text-xl rounded-full border {{getBadgeStyle(section)}}"
         (click)="activeBadge = section"
    >
      {{ section }}
    </div>
    <div *ngFor="let ts of trackworks"
         class="px-4 pt-1.5 pb-2 text-xl rounded-full border {{getBadgeStyle(ts.meeting)}}"
         (click)="activeBadge = ts.meeting"
    >
      {{ formatMeeting(ts.meeting) }}
      {{ ts.venue }}
    </div>
  </div>

  <div *ngIf="![BY_FOCUS].includes(activeBadge)"
       class="mx-4 grid grid-cols-4 gap-x-4 gap-y-2"
  >
    <div *counter="let race of maxRace"
         class="pt-2 pb-3 px-4 shadow-md transition shadow-gray-600 hover:shadow-gray-400"
    >
      <div class="mb-2 text-yellow-400 text-lg">
        Race #{{ race }}
      </div>
      <div *ngFor="let starter of getRaceStarters(race); let index = index"
           class="grid grid-cols-12 {{toPlacingColor(starter?.placing)}}"
           [class.opacity-50]="starter.scratched"
           [class.line-through]="starter.scratched"
      >
        <div class="col-span-1">
          <span *ngIf="starter.trainerFocus">
            <i class="fa fa-chevron-right"></i>
          </span>
        </div>
        <div class="col-span-1">
          {{ starter.order }}
        </div>
        <div class="col-span-4">
          {{ starter.horseNameCH }}
        </div>
        <div class="col-span-2">
          {{ starter.trainer }}
        </div>
        <div [class.invisible]="getStarterWinOdds(starter) < 1"
             class="col-span-2 {{ toPlacingColor(starter?.placing).length === 0
                                    ? getOddsIntensityColor(getStarterWinOdds(starter))
                                    : ''
                               }}"
        >
          {{ getStarterWinOdds(starter) | number: '1.0-1' }}
        </div>
        <div class="col-span-2 {{getGradeBorderStyle(race, starter, index)}}">
          {{ starter.intensity.toFixed(1) }}
          {{ starter.grade }}
        </div>
      </div>
    </div>
  </div>

  <table *ngIf="activeBadge === BY_FOCUS"
         class="my-8 mx-auto table-fixed border-collapse"
  >
    <tr class="text-lg">
      <td class="w-20 border border-gray-700"></td>
      <td *ngFor="let ts of trackworks"
          class="w-64 border border-gray-700"
      >
        {{ formatMeeting(ts.meeting) }}
        &nbsp;
        {{ ts.venue }}
      </td>
    </tr>
    <tr *ngFor="let trainer of trainers"
        class="hover:bg-gray-800"
    >
      <td class="border border-gray-700 px-1 py-0.5 text-lg"
          [class.border-b-gray-400]="trainer.boundary"
      >
        {{ trainer.code }}
      </td>
      <td *ngFor="let ts of trackworks; let first = first"
          class="border border-gray-700 px-1 py-0.5"
          [class.border-b-gray-400]="trainer.boundary"
      >
        <div *ngIf="getTrainerFocusStarter(ts, trainer)"
             class="flex flex-row justify-center items-center gap-x-1 text-sm
                    {{toPlacingColor(getTrainerFocusStarter(ts, trainer)?.placing)}}"
             [class.opacity-0]="!first && toPlacingColor(getTrainerFocusStarter(ts, trainer)?.placing).length < 1"
        >
          <div [class.invisible]="getStarterWinOdds(getTrainerFocusStarter(ts, trainer)) < 1"
               class="{{ toPlacingColor(getTrainerFocusStarter(ts, trainer)?.placing).length === 0
                               ? getOddsIntensityColor(getStarterWinOdds(getTrainerFocusStarter(ts, trainer)))
                               : ''
                      }}"
          >
            {{ getStarterWinOdds(getTrainerFocusStarter(ts, trainer)) | number: '1.0-1' }}
          </div>
          <div class="text-xs">
            {{ getTrainerFocusStarter(ts, trainer)?.horseNameCH }}
          </div>
          <div>
            {{ getTrainerFocusStarter(ts, trainer)?.jockey }}
          </div>
          <div>
            {{ (getTrainerFocusStarter(ts, trainer)?.intensity || 0).toFixed(1) }}
            {{ getTrainerFocusStarter(ts, trainer)?.grade }}
          </div>
        </div>
      </td>
    </tr>
  </table>
</div>
