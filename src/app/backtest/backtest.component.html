<div class="mx-12 my-8 flex flex-row gap-x-8 items-start text-center">
  <div class="w-72 flex flex-col gap-y-4">
    <div class="text-xl bg-gray-800 rounded-full flex flex-row justify-between">
      <div *ngFor="let mode of modes"
           class="w-full py-1.5 rounded-full {{getModeStyle(mode)}}"
           (click)="setActiveMode(mode)"
      >
        {{ mode }}
      </div>
    </div>
    <div class="flex flex-row justify-center gap-x-3">
      <div *ngFor="let action of actions"
           class="px-2 pt-1.5 pb-2 text-lg rounded-lg hvr-grow-shadow cursor-pointer border border-gray-600 hover:border-yellow-400"
           [class.opacity-25]="isLoading || (action === 'Run Tests' && factorCombinations.length === 0)"
           (click)="process(action)"
      >
        {{ action }}
      </div>
    </div>
    <div>
      <span class="text-xl">
        Factor Combinations:
      </span>
      <span class="mx-2 text-2xl text-yellow-400">
        {{ factorCombinations.length }}
      </span>
    </div>
    <div class="mb-2 flex flex-row justify-around items-center">
      <div class="px-4 py-0.5 rounded-xl border border-gray-600 hover:border-yellow-400 cursor-pointer"
           (click)="process('Decrease Size')"
      >
        <i class="fa fa-minus"></i>
      </div>
      <div>
        <span class="text-xl">
          Group Size &#8829;
        </span>
        <span class="mx-2 text-2xl text-yellow-400">
          {{ minFactorGroupSize }}
        </span>
      </div>
      <div class="px-4 py-0.5 rounded-xl border border-gray-600 hover:border-yellow-400 cursor-pointer"
           (click)="process('Increase Size')"
      >
        <i class="fa fa-plus"></i>
      </div>
    </div>
    <div *ngFor="let factor of factors"
         class="px-4 py-2 text-lg rounded-full hvr-float-shadow cursor-pointer border {{getBadgeStyle(factor.name)}}"
         (mouseenter)="hoveringFactor = factor"
    >
      <div class="grid grid-cols-12">
        <div class="col-span-2">
          {{ factor.order }}
          <sup *ngIf="factor.negative">N</sup>
        </div>
        <div class="col-span-8"
             (click)="toggleFactor(factor.name)"
        >
          {{ factor.name }}
        </div>
        <div class="col-span-2"
             (click)="toggleFactor(factor.name, true)"
        >
          <div *ngIf="bankerFactors.includes(factor.name)">
            <i class="fa fa-star"></i>
          </div>
          <div *ngIf="!bankerFactors.includes(factor.name)">
            <i class="fa fa-star-o"></i>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="hoveringFactor"
         class="h-64 px-4 pt-2 pb-2.5 flex flex-col gap-y-2 text-lg border rounded-xl border-gray-600"
    >
      <div class="text-yellow-400 font-bold">
        Factor #{{ hoveringFactor.order }}
      </div>
      <div class="text-left">
        {{ hoveringFactor.description }}
        <em *ngIf="hoveringFactor.negative">
          This is a negative factor.
        </em>
      </div>
    </div>
  </div>

  <div class="mx-auto">
    <div *ngIf="isLoading">
      <app-spinner></app-spinner>
    </div>
    <table *ngIf="!isLoading"
           class="mx-auto table-fixed border-collapse border border-gray-600 text-center"
    >
      <thead class="text-lg">
        <th class="w-20 border border-gray-600">
          Rank
        </th>
        <th *ngFor="let pool of accuracyFields; let index = index"
            class="border border-gray-600"
            [class.w-20]="index >= 5"
            [class.w-24]="index >= 1 && index <= 4"
            [class.w-48]="index == 0"
        >
          {{ pool }}
        </th>
      </thead>
      <tbody>
        <tr *ngFor="let fh of factorHits; let index = index"
            class="hover:bg-gray-800"
        >
          <td class="border border-gray-700 py-1">
            {{ index + 1 }}
          </td>
          <td class="border border-gray-700 py-1 cursor-pointer"
              [class.text-yellow-400]="activeFactorHitIndex === index"
              (click)="activeFactorHitIndex = index"
          >
            {{ formatFactorCombination(fh.factors) }}
          </td>
          <td *ngFor="let fhp of fh.hits"
              class="border border-gray-700 py-1"
          >
            <div class="flex flex-row justify-around">
              <div [class.text-yellow-400]="isTopPlacingHit(fhp)">
                {{ fhp.hitRaces }}
              </div>
              <div>
                {{ (fhp.hitRaces / fhp.betRaces) | percent }}
              </div>
            </div>
          </td>
          <td class="border border-gray-700 py-1">
            {{ fh.totalHits }}
          </td>
          <td class="border border-gray-700 py-1 {{getFactorROIColor(fh.yields)}}">
            {{ getTesterAvgROI(fh.yields) === 0 ? '-' : getTesterAvgROI(fh.yields) | percent:'1.1-2' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<table class="mx-auto my-10 table-fixed border-collapse border border-gray-600 text-center">
  <thead class="text-lg">
    <th *ngFor="let pool of profitabilityFields; let index = index"
        class="border border-gray-600 py-1"
        [class.px-4]="[1].includes(index)"
        [class.px-12]="[2].includes(index)"
        [class.px-36]="[0].includes(index)"
        [class.px-8]="![0, 1, 2].includes(index)"
    >
      {{ pool }}
    </th>
  </thead>
  <tbody>
    <tr *ngFor="let tyield of activeYields"
        class="hover:bg-gray-800"
    >
      <td class="border border-gray-700 py-1 px-2 text-left cursor-pointer"
          tooltip="{{tyield.description}}"
          [hideDelay]="0"
          [class.text-yellow-400]="activeVersion === tyield.version"
          (click)="activeVersion = tyield.version"
      >
        {{ tyield.version }}
      </td>
      <td class="border border-gray-700 py-1">
        <div class="grid grid-cols-3 gap-x-1 px-6">
          <div class="text-green-600">
            {{ countMeetings(tyield)[0] }}
          </div>
          <div>/</div>
          <div>
            {{ countMeetings(tyield)[1] }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1 px-2">
        <div class="grid grid-cols-4 gap-x-2.5">
          <div *ngFor="let races of countRaces(tyield); let index = index"
               [class.text-green-600]="index === 0"
               [class.text-blue-600]="index === 1"
          >
            {{ races }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1">
        <div class="w-11/12 mx-auto grid grid-cols-3 px-2">
          <div class="text-green-600">
            {{ countBetlines(tyield)[0] }}
          </div>
          <div>/</div>
          <div>
            {{ countBetlines(tyield)[1] }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1 text-red-600">
        -{{ tyield.debit | currency:'USD':'symbol':'1.0-0' }}
      </td>
      <td class="border border-gray-700 py-1 text-green-600">
        +{{ tyield.credit | currency:'USD':'symbol':'1.0-0' }}
      </td>
      <td class="border border-gray-700 py-1"
          [class.text-red-600]="tyield.credit < tyield.debit"
          [class.text-green-600]="tyield.credit > tyield.debit"
      >
        {{ (tyield.credit - tyield.debit) | currency:'USD':'symbol':'1.0-0' }}
      </td>
      <td class="border border-gray-700 py-1 {{getTesterROIColor(tyield)}}">
        {{ getReturnOnInvestment(tyield) }}
      </td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td *ngFor="let _ of profitabilityFields; let last = last"
          class="border border-gray-700 py-1 text-lg font-bold"
      >
        {{ !last ? '' : getTesterAvgROI(activeYields) }}
      </td>
    </tr>
  </tfoot>
</table>

<table class="mx-auto my-10 table-fixed border-collapse border border-gray-600 text-center">
  <thead class="text-lg">
    <th class="border border-gray-600 py-1 px-6">
      #
    </th>
    <th *ngFor="let field of meetingFields; let index = index"
        class="border border-gray-600 py-1"
        [class.px-6]="![1,2].includes(index)"
        [class.px-10]="[1,2].includes(index)"
    >
      {{ field }}
    </th>
  </thead>
  <tbody>
    <tr *ngFor="let myield of meetingYields; let index = index"
        class="hover:bg-gray-800"
    >
      <td class="border border-gray-700 py-1 font-mono">
        {{ index + 1 }}
      </td>
      <td class="border border-gray-700 py-1 font-mono">
        {{ myield.meeting }}
      </td>
      <td class="border border-gray-700 py-1 px-2">
        <div class="grid grid-cols-6 gap-x-2">
          <div *ngFor="let race of getProfitRacesOnMeeting(myield)">
            {{ race }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1 px-2">
        <div class="grid grid-cols-4 gap-x-2">
          <div *ngFor="let races of countRaces(myield); let index = index"
               [class.text-green-600]="index === 0"
               [class.text-blue-600]="index === 1"
          >
            {{ races }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1">
        <div class="grid grid-cols-3 gap-x-1 px-6">
          <div class="{{countBetlinesOnMeeting(myield)[0] === 0 ? 'text-yellow-400' : 'text-green-600'}}">
            {{ countBetlinesOnMeeting(myield)[0] }}
          </div>
          <div>/</div>
          <div>
            {{ countBetlinesOnMeeting(myield)[1] }}
          </div>
        </div>
      </td>
      <td class="border border-gray-700 py-1 text-red-600">
        -{{ myield.debit | currency:'USD':'symbol':'1.0-0' }}
      </td>
      <td class="border border-gray-700 py-1">
        <span *ngIf="myield.credit > 0" class="text-green-600">
          +{{ myield.credit | currency:'USD':'symbol':'1.0-0' }}
        </span>
        <span *ngIf="myield.credit <= 0" class="text-yellow-400">
          X
        </span>
      </td>
      <td class="border border-gray-700 py-1"
          [class.text-red-600]="myield.credit < myield.debit"
          [class.text-green-600]="myield.credit > myield.debit"
      >
        {{ (myield.credit - myield.debit) | currency:'USD':'symbol':'1.0-0' }}
      </td>
      <td class="border border-gray-700 py-1 {{getMeetingROIColor(myield)}}">
        {{ getReturnOnInvestment(myield) ? getReturnOnInvestment(myield) : '' }}
      </td>
    </tr>
  </tbody>
</table>
